# ============================================================
# Open Short URL - Backend Environment Configuration
# ============================================================
# Copy this file to .env and update the values accordingly.
#
# Legend:
#   [REQUIRED]    - Must be set for production deployment
#   [RECOMMENDED] - Should be configured for optimal operation
#   [Optional]    - Has sensible defaults, adjust as needed
#
# ============================================================
# QUICK REFERENCE - Production Checklist
# ============================================================
# Before deploying to production, ensure these are properly set:
#
#   [REQUIRED]
#   - NODE_ENV=production
#   - DATABASE_URL (production database)
#   - JWT_SECRET (strong random key, min 32 chars)
#   - ADMIN_INITIAL_PASSWORD (strong password)
#   - SHORT_URL_DOMAIN (your actual domain)
#   - FRONTEND_URL (your frontend domain)
#   - CORS_ORIGIN (your frontend domain)
#
#   [RECOMMENDED]
#   - REDIS_* (for caching and rate limiting)
#   - TURNSTILE_* (anti-bot protection)
#   - WEBHOOK_SECRET_KEY (if using webhooks)
#   - SMTP_* (if sending emails)
#
# ============================================================


# ============================
# CORE SETTINGS
# ============================

# [REQUIRED] Environment: development | production | test
NODE_ENV=development

# [Optional] Server port (default: 4101)
PORT=4101

# [Optional] Server host binding (default: 0.0.0.0)
# Use 127.0.0.1 to restrict to localhost only
HOST=0.0.0.0


# ============================
# DATABASE [REQUIRED]
# ============================

# [REQUIRED] PostgreSQL connection string
# Connection pool parameters:
#   - connection_limit: Max connections (dev: 10-15, prod: 20-30)
#   - pool_timeout: Pool timeout in seconds (default: 10)
#   - connect_timeout: Connection timeout in seconds (default: 5)
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/open_short_url?schema=public&connection_limit=15&pool_timeout=20&connect_timeout=5"


# ============================
# REDIS CACHE [RECOMMENDED]
# ============================

# [Recommended] Redis connection settings
# If not configured, falls back to in-memory storage (not recommended for production)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0


# ============================
# AUTHENTICATION [REQUIRED]
# ============================

# [REQUIRED] JWT secret key for token signing
# ⚠️  SECURITY: Use a strong, unique random string (min 32 characters)
# Generate with: openssl rand -base64 32
JWT_SECRET=your-super-secret-jwt-key-change-in-production

# [Optional] Token expiration (examples: 1h, 1d, 7d, 30d)
JWT_EXPIRES_IN=7d

# [REQUIRED for production] Initial admin account password
# If not set, a random password will be generated during seeding
# ⚠️  SECURITY: Use a strong password for production
ADMIN_INITIAL_PASSWORD=admin123


# ============================
# URL & DOMAIN [REQUIRED]
# ============================

# [REQUIRED] Domain for generating short URLs (include protocol)
# Examples: https://short.example.com, http://localhost:4101
SHORT_URL_DOMAIN=http://localhost:4101

# [REQUIRED] Frontend application URL
# Used for redirects and generating frontend links
FRONTEND_URL=http://localhost:4100

# [REQUIRED] Allowed origins for CORS
# Use comma-separated values for multiple origins
# Example: https://app.example.com,https://admin.example.com
CORS_ORIGIN=http://localhost:4100


# ============================
# COOKIE [Optional]
# ============================

# [Optional] Cookie domain for cross-subdomain authentication
# Auto-detected by default - only override if needed
# Examples:
#   - Cross-subdomain (api.example.com & app.example.com): .example.com
#   - Single domain or localhost: leave empty
COOKIE_DOMAIN=


# ============================
# PROXY [Optional]
# ============================

# [Optional] Enable trusted proxy mode
# Set to 'true' if behind reverse proxy (nginx, cloudflare, etc.)
# Enables reading client IP from X-Forwarded-For and X-Real-IP headers
# ⚠️  SECURITY: Only enable if you trust your proxy
TRUSTED_PROXY=


# ============================
# RATE LIMITING [Optional]
# ============================

# [Optional] Rate limit time window in seconds (default: 60)
THROTTLE_TTL=60

# [Optional] Maximum requests per time window (default: 10)
THROTTLE_LIMIT=10


# ============================
# SLUG GENERATION [Optional]
# ============================

# Dynamic slug length based on total URL count
# Thresholds: comma-separated URL count thresholds
# Lengths: comma-separated slug lengths for each range

# Thresholds for dynamic slug length adjustment
SLUG_LENGTH_THRESHOLDS=1000,50000,500000

# Corresponding slug lengths:
#   count < 1000         -> 4 chars
#   1000 <= count < 50000   -> 5 chars
#   50000 <= count < 500000 -> 6 chars
#   count >= 500000         -> 7 chars
SLUG_LENGTHS=4,5,6,7


# ============================
# BRANDING [Optional]
# ============================

# [Optional] Brand name shown on password-protected pages
BRAND_NAME=Open Short URL

# [Optional] Brand logo URL (leave empty for text-only)
BRAND_LOGO_URL=


# ============================
# API KEYS [Optional]
# ============================

# [Optional] Maximum API keys per user (default: 10)
MAX_API_KEYS_PER_USER=10

# [Optional] Bcrypt rounds for API key hashing (default: 10)
# Higher = more secure but slower generation
BCRYPT_ROUNDS=10


# ============================
# WEBHOOKS [Optional]
# ============================

# [Recommended if using webhooks] Secret key for signing payloads
# Generate with: openssl rand -hex 32
# If not set, webhook payloads will not include signatures
WEBHOOK_SECRET_KEY=


# ============================
# ANALYTICS [Optional]
# ============================

# Export settings
ANALYTICS_EXPORT_MAX_RECORDS=10000    # Max records per export (default: 10000)
ANALYTICS_EXPORT_BATCH_SIZE=1000      # Batch size for pagination (default: 1000)

# Query settings
ANALYTICS_CACHE_TTL=300               # Cache TTL in seconds (default: 300)
ANALYTICS_TOP_URLS_LIMIT=10           # Top URLs in overview (default: 10)
ANALYTICS_RECENT_CLICKS_LIMIT=100     # Recent clicks limit (default: 100)

# Performance thresholds
ANALYTICS_MAX_IN_MEMORY_CLICKS=50000  # Max clicks for in-memory processing
ANALYTICS_AGGREGATION_THRESHOLD=10000 # Switch to DB aggregation above this


# ============================
# EMAIL / SMTP [Optional]
# ============================

# [Optional] SMTP configuration for sending emails
# Leave unconfigured if email features are not needed
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
SMTP_FROM=noreply@example.com


# ============================
# CLOUDFLARE TURNSTILE [Recommended]
# ============================

# [Recommended] Anti-bot protection for password-protected URLs
# Leave empty to disable bot protection
# Get keys from: https://dash.cloudflare.com/?to=/:account/turnstile
#
# Testing keys (always passes):
#   Site Key:   1x00000000000000000000AA
#   Secret Key: 1x0000000000000000000000000000000AA
#
# Testing keys (always fails):
#   Visible:    2x00000000000000000000AB / 2x0000000000000000000000000000000AA
#   Invisible:  3x00000000000000000000FF / 3x0000000000000000000000000000000AA

TURNSTILE_SECRET_KEY=1x0000000000000000000000000000000AA
TURNSTILE_SITE_KEY=1x00000000000000000000AA
